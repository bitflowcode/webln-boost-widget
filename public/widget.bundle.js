
// Asegurarnos de que las dependencias estén disponibles
if (!window.React || !window.ReactDOM || !window.bech32) {
  throw new Error('Dependencias no cargadas correctamente');
}

// Función global para renderizar el widget
window.renderBitflowWidget = (container, config) => {
  const { useState, useEffect } = window.React;
  const { createRoot } = window.ReactDOM;
  const { bech32 } = window.bech32;
  
  
        var process = { env: { NODE_ENV: 'production' } };
        var require = undefined;
        var module = undefined;
        var exports = undefined;
      
"use client";(()=>{var pe=Object.create;var J=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var fe=Object.getOwnPropertyNames;var ge=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty;var we=(r,t,i,x)=>{if(t&&typeof t=="object"||typeof t=="function")for(let f of fe(t))!me.call(r,f)&&f!==i&&J(r,f,{get:()=>t[f],enumerable:!(x=be(t,f))||x.enumerable});return r};var j=(r,t,i)=>(i=r!=null?pe(ge(r)):{},we(t||!r||!r.__esModule?J(i,"default",{value:r,enumerable:!0}):i,r));var W=(r,t,i)=>new Promise((x,f)=>{var B=g=>{try{v(i.next(g))}catch(u){f(u)}},_=g=>{try{v(i.throw(g))}catch(u){f(u)}},v=g=>g.done?x(g.value):Promise.resolve(g.value).then(B,_);v((i=i.apply(r,t)).next())});var l=require("react"),M=require("webln"),N=require("@/app/components/ui/button"),Z=require("qrcode.react"),K=j(require("./widget-info-tooltip")),X=j(require("./ui/robo-avatar")),Y=j(require("./ui/custom-avatar")),T=require("bech32");const he="bitflowz@getalby.com",xe=r=>{try{const{words:t}=T.bech32.decode(r,2e3),i=T.bech32.fromWords(t);return new TextDecoder().decode(new Uint8Array(i))}catch(t){return r}},ve=(r,t)=>Array.isArray(r)&&r[t]||"";function ye({receiverType:r="lightning",receiver:t=he,amounts:i=[21,100,1e3],labels:x=["Caf\xE9","Propina","Boost"],theme:f="orange",incrementSpeed:B=50,incrementValue:_=10,avatarSeed:v,avatarSet:g="set1",image:u,hideWebLNGuide:L=!1}){const[G,m]=(0,l.useState)("initial"),[U,C]=(0,l.useState)(0),[P,D]=(0,l.useState)(""),[q,R]=(0,l.useState)(null),[ee,c]=(0,l.useState)(""),[$,z]=(0,l.useState)(""),[H,I]=(0,l.useState)(!1),[k,oe]=(0,l.useState)(!1),[S,V]=(0,l.useState)(!1),[te,ne]=(0,l.useState)(!1);(0,l.useEffect)(()=>{console.log("WebLNBoostButton props:",{receiverType:r,receiver:t,amounts:i,labels:x,theme:f,avatarSeed:v,avatarSet:g,image:u}),console.log("Avatar debug info:",{hasAvatarSeed:!!v,avatarSeedValue:v,avatarSetValue:g,hasImage:!!u,imageValue:u})},[r,t,i,x,f,v,g,u]),(0,l.useEffect)(()=>{const e=()=>{const o=/iPhone|iPad|Android/i.test(navigator.userAgent);oe(o),(o||L)&&c("")};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[L]),(0,l.useEffect)(()=>{const e=()=>W(this,null,function*(){try{if(console.log("Iniciando initWebLN..."),!k&&!L){console.log("Verificando disponibilidad de WebLN...");let o=0;const s=20,a=()=>W(this,null,function*(){try{const n=window!==window.parent;console.log("\xBFEstamos en iframe?",n);const p=typeof window!="undefined"&&(window.webln&&typeof window.webln.enable=="function"||window.alby&&typeof window.alby.enable=="function");let y=!1;try{n&&window.parent&&(y=!!(window.parent.webln&&typeof window.parent.webln.enable=="function"||window.parent.alby&&typeof window.parent.alby.enable=="function"))}catch(d){console.log("Error al acceder al contexto padre:",d)}if(console.log("WebLN en contexto actual:",p),console.log("WebLN en contexto padre:",y),p||y){console.log("WebLN o Alby detectado");try{let d;n&&y?(console.log("Intentando usar WebLN del contexto padre"),d=window.parent.webln||window.parent.alby):(console.log("Intentando usar WebLN del contexto actual"),d=yield(0,M.requestProvider)()),d&&(console.log("Provider obtenido:",d),yield d.enable(),console.log("WebLN habilitado autom\xE1ticamente"),R(d),c(""))}catch(d){console.log("WebLN detectado pero requiere autorizaci\xF3n manual:",d),c("Haz clic en 'Donate Sats' para habilitar el pago directo con Alby")}}else if(o++,o<s){console.log(`Intento ${o} de ${s}...`);const d=Math.min(500+o*100,2e3);setTimeout(a,d)}else console.log("WebLN no detectado despu\xE9s de m\xFAltiples intentos"),c("No se detect\xF3 una billetera compatible con WebLN")}catch(n){if(console.error("Error en checkWebLN:",n),o++,o<s){const p=Math.min(500+o*100,2e3);setTimeout(a,p)}}});setTimeout(a,1e3)}}catch(o){console.error("Error al inicializar WebLN:",o),F(o)}});return R(null),c(""),e(),()=>{R(null),c("")}},[k,L]);const re=()=>W(this,null,function*(){try{console.log("Iniciando habilitaci\xF3n de WebLN...");const e=window!==window.parent;console.log("\xBFEstamos en iframe? (handleUserConsent):",e);let o;try{e&&window.parent&&(window.parent.webln||window.parent.alby)?(console.log("Usando WebLN del contexto padre"),o=window.parent.webln||window.parent.alby):(console.log("Obteniendo proveedor WebLN del contexto actual"),o=yield(0,M.requestProvider)())}catch(s){throw console.error("Error al obtener el proveedor:",s),s}if(console.log("Provider obtenido:",o),!o)throw new Error("No se pudo obtener el proveedor WebLN");if(o._isEnabled){console.log("WebLN ya est\xE1 habilitado"),R(o),c("");return}yield o.enable(),console.log("WebLN habilitado correctamente"),R(o),c("")}catch(e){console.error("Error al habilitar WebLN:",e),F(e)}}),F=e=>{var o,s,a,n;R(null),!k&&!L&&(e instanceof Error?(o=e.message)!=null&&o.toLowerCase().includes("not authorized")||(s=e.message)!=null&&s.toLowerCase().includes("permission denied")?c("Este sitio necesita autorizaci\xF3n en Alby. Por favor, autoriza el sitio en la extensi\xF3n y recarga la p\xE1gina."):(a=e.message)!=null&&a.toLowerCase().includes("no provider available")?c("No se detect\xF3 una billetera compatible con WebLN"):(n=e.message)!=null&&n.toLowerCase().includes("user rejected")?c("Pago cancelado por el usuario"):c("Error al inicializar WebLN"):c("Error desconocido al inicializar WebLN"))};(0,l.useEffect)(()=>{let e=null;return H&&(e=setInterval(()=>{C(o=>o+_)},B)),()=>{e&&clearInterval(e)}},[H,_,B]),(0,l.useEffect)(()=>{ne(!0)},[]);const ae=e=>{e<=0||C(e)},se=e=>{const o=parseInt(e.target.value);o<0?C(0):C(o)},le=e=>{D(e.target.value)},Q=()=>{C(0),D(""),m("initial")},ie=()=>W(this,null,function*(){var s,a;const e=Math.round(U*1e3);let o;try{if(r==="lnurl")try{console.log("Procesando LNURL:",t);let p;t.toLowerCase().startsWith("lnurl")?p=xe(t):p=t,console.log("URL decodificada o directa:",p);const y=yield fetch(p);if(!y.ok)throw console.error("Error en respuesta inicial:",y.status),new Error(`Error al obtener par\xE1metros LNURL: ${y.status}`);const b=yield y.json();if(console.log("Par\xE1metros LNURL recibidos:",b),!b.tag||b.tag!=="payRequest")throw console.error("Tag inv\xE1lido:",b.tag),new Error("El LNURL proporcionado no es un endpoint de pago v\xE1lido");if(console.log(`Verificando monto ${e} entre ${b.minSendable} y ${b.maxSendable}`),e<b.minSendable||e>b.maxSendable)throw new Error(`El monto debe estar entre ${b.minSendable/1e3} y ${b.maxSendable/1e3} sats`);const d=new URL(b.callback);d.searchParams.append("amount",e.toString());let E,h;try{if(P&&d.searchParams.append("comment",P),E=yield fetch(d.toString()),h=yield E.json(),h.status==="ERROR"&&((s=h.reason)!=null&&s.toLowerCase().includes("comment"))){console.log("El servicio no acepta comentarios, reintentando sin comentario");const A=new URL(b.callback);A.searchParams.append("amount",e.toString()),E=yield fetch(A.toString()),h=yield E.json()}}catch(A){throw console.error("Error al obtener la factura:",A),new Error("Error al generar la factura LNURL")}if(!E.ok)throw console.error("Error en respuesta de factura:",E.status),new Error(`Error al generar la factura LNURL: ${E.status}`);if(console.log("Datos de factura recibidos:",h),h.pr)return console.log("Factura encontrada en pr"),h.pr;if(h.invoice)return console.log("Factura encontrada en invoice"),h.invoice;throw console.error("No se encontr\xF3 factura en la respuesta:",h),new Error("No se pudo obtener la factura del servicio LNURL")}catch(p){throw console.error("Error detallado en el proceso LNURL:",p),new Error(`Error procesando LNURL: ${p instanceof Error?p.message:"Error desconocido"}`)}switch(r){case"lightning":o=yield fetch(`https://api.getalby.com/lnurl/generate-invoice?ln=${t}&amount=${e}&comment=${encodeURIComponent(P||"Boost con Bitflow")}`);break;case"node":o=yield fetch(`https://api.getalby.com/payments/keysend?node_id=${t}&amount=${e}&comment=${encodeURIComponent(P||"Boost con Bitflow")}`);break;default:throw new Error("Tipo de receptor no v\xE1lido")}if(!o.ok)throw new Error(`Error al generar factura: ${o.status}`);const n=yield o.json();if(console.log("Respuesta:",n),!((a=n.invoice)!=null&&a.pr)||typeof n.invoice.pr!="string")throw new Error("La factura no se gener\xF3 correctamente");return n.invoice.pr}catch(n){throw console.error("Error en generateInvoice:",n),n}}),ce=()=>te?t?!0:(console.warn("Por favor, ingresa una direcci\xF3n de receptor"),!1):!0,de=()=>W(this,null,function*(){var e,o,s;if(!(S||!ce()))try{V(!0),console.log("Iniciando proceso de pago...");const a=yield ie();if(console.log("Factura generada:",a),k||!q){console.log("Mostrando QR (m\xF3vil o sin WebLN)"),z(a),m("qr");return}try{console.log("Intentando pago con WebLN"),yield q.sendPayment(a),console.log("Pago completado con \xE9xito"),Q()}catch(n){console.error("Error detallado en pago WebLN:",n),n instanceof Error?(e=n.message)!=null&&e.includes("User rejected")?(c("Pago cancelado por el usuario."),m("initial")):(o=n.message)!=null&&o.includes("not authorized")||(s=n.message)!=null&&s.includes("Permission denied")?(c("Este sitio necesita autorizaci\xF3n en Alby para pagar directamente. Por favor, autoriza el sitio en la extensi\xF3n Alby y vuelve a intentarlo."),m("qr")):(console.log("Mostrando QR despu\xE9s de error WebLN"),z(a),m("qr")):(console.log("Mostrando QR despu\xE9s de error WebLN"),z(a),m("qr"))}}catch(a){console.error("Error detallado en handleBoost:",a);const n=a instanceof Error?a.message:"Error desconocido";c(`Error al generar la factura: ${n}`),m("initial")}finally{V(!1)}}),O={orange:"#FF8C00",blue:"#3B81A2",green:"#2E7D32"},w=O[f]||O.orange,ue=()=>{if(u){let e=u;if(/^[A-Za-z0-9_-]+={0,2}$/.test(u))try{const o=u.replace(/-/g,"+").replace(/_/g,"/").padEnd(u.length+(4-u.length%4)%4,"="),s=atob(o);s.startsWith("http")&&(e=s)}catch(o){console.error("Error decodificando URL en renderAvatar:",o)}return React.createElement(Y.default,{imageUrl:e,size:128})}return React.createElement(X.default,{seed:v||"default",set:g,size:128})};return React.createElement("div",{className:"flex flex-col items-center bg-transparent"},React.createElement("div",{className:"w-[460px] h-[420px] relative flex items-center justify-center bg-transparent"},React.createElement("div",{className:"w-[420px] h-[420px] rounded-2xl p-6 space-y-4 transition-all duration-300 overflow-hidden flex flex-col items-center justify-center",style:{backgroundColor:w,minHeight:"420px",minWidth:"420px"}},(()=>{switch(G){case"initial":return React.createElement("div",{className:"flex flex-col items-center gap-6"},React.createElement("div",{className:"w-32 h-32 relative"},ue()),React.createElement("h2",{className:"text-4xl font-bold text-white"},"Bitflow"),React.createElement(N.Button,{onClick:()=>W(this,null,function*(){!k&&!L&&(yield re()),m("amount")}),className:"bg-white hover:bg-white/90 font-bold text-lg px-8 py-3 rounded-full shadow-[0_8px_16px_rgba(0,0,0,0.15)] hover:shadow-[0_12px_24px_rgba(0,0,0,0.2)] transition-all duration-200",style:{color:w}},"Donate Sats"));case"amount":return React.createElement(React.Fragment,null,React.createElement("h1",{className:"text-3xl font-bold text-white mb-6"},"How many Sats?"),React.createElement("div",{className:"flex gap-3 mb-4 w-full max-w-[360px] justify-center"},i.map((e,o)=>React.createElement(N.Button,{key:e,onClick:()=>ae(e),className:`rounded-full px-4 py-3 flex-1 text-sm flex flex-col items-center leading-tight h-[70px] justify-center ${U===e?"bg-white":"bg-transparent text-white border-2 border-white"}`,style:U===e?{color:w}:{}},React.createElement("span",{className:"font-medium"},ve(x,o)||e),React.createElement("span",{className:"text-xs mt-1"},e," sats")))),React.createElement(N.Button,{onMouseDown:()=>I(!0),onMouseUp:()=>I(!1),onMouseLeave:()=>I(!1),onTouchStart:()=>I(!0),onTouchEnd:()=>I(!1),className:"w-22 h-22 mb-4 rounded-full bg-white hover:bg-white/90 font-bold flex items-center justify-center shadow-lg transform active:scale-95 transition-transform",style:{color:w}},React.createElement("div",{className:"flex flex-col items-center justify-center h-full text-xs font-bold"},React.createElement("span",null,"Press"),React.createElement("span",null,"to Boost"),React.createElement("span",{className:"text-lg mt-1 font-bold"},"\u26A1"))),React.createElement("div",{className:"w-full max-w-[360px] flex justify-center"},React.createElement("input",{type:"number",inputMode:"numeric",pattern:"[0-9]*",value:U||"",onChange:se,placeholder:"Enter an amount",className:"w-full px-4 py-2 mb-4 rounded-full text-center text-lg placeholder:text-gray-400 focus:outline-none focus:ring-2",style:{color:w,"--tw-ring-color":w}})),React.createElement("div",{className:"flex gap-4"},React.createElement(N.Button,{onClick:()=>m("initial"),className:"bg-transparent hover:bg-white/10 text-white border-2 border-white font-bold text-lg px-6 py-3 rounded-full transition-all duration-200"},"Back"),React.createElement(N.Button,{onClick:()=>m("note"),className:"bg-white hover:bg-white/90 font-bold text-lg px-6 py-3 rounded-full shadow-[0_8px_16px_rgba(0,0,0,0.15)] hover:shadow-[0_12px_24px_rgba(0,0,0,0.2)] transition-all duration-200",style:{color:w}},"Next")));case"note":return React.createElement(React.Fragment,null,React.createElement("h1",{className:"text-3xl font-bold text-white mb-8"},"Want to add a note?"),React.createElement("textarea",{value:P,onChange:le,placeholder:"Enter your note",className:"w-full max-w-[360px] p-4 rounded-3xl text-xl mb-6 h-40 resize-none placeholder:text-gray-400 focus:outline-none focus:ring-2",style:{color:w,"--tw-ring-color":w}}),React.createElement("div",{className:"flex gap-4"},React.createElement(N.Button,{onClick:()=>m("amount"),className:"bg-transparent hover:bg-white/10 text-white border-2 border-white font-bold text-lg px-6 py-3 rounded-full transition-all duration-200"},"Back"),React.createElement(N.Button,{onClick:de,disabled:S,className:`bg-white hover:bg-white/90 font-bold text-xl px-8 py-4 rounded-full shadow-[0_8px_16px_rgba(0,0,0,0.15)] hover:shadow-[0_12px_24px_rgba(0,0,0,0.2)] transition-all duration-200
                  ${S?"opacity-50 cursor-not-allowed":""}`,style:{color:w}},S?"Processing...":"Next")));case"qr":return React.createElement("div",{className:"w-full h-full flex flex-col items-center justify-between gap-4"},React.createElement("div",{className:"flex flex-col items-center gap-4 overflow-y-auto max-h-[90%] w-full"},React.createElement("div",{className:"bg-white p-4 rounded-lg flex-shrink-0"},React.createElement(Z.QRCodeSVG,{value:$,size:200})),React.createElement("div",{className:"w-full bg-[#2d2d2d] p-3 rounded-lg flex-shrink-0"},React.createElement("div",{className:"flex items-center justify-between mb-2"},React.createElement("p",{className:"text-xs text-white/70"},"Lightning Invoice:"),React.createElement("button",{onClick:()=>navigator.clipboard.writeText($),className:"text-xs bg-white/10 hover:bg-white/20 text-white px-2 py-1 rounded transition-colors"},"Copiar")),React.createElement("p",{className:"text-[10px] text-white/90 font-mono break-all whitespace-pre-wrap"},$))),React.createElement(N.Button,{onClick:Q,className:"bg-white hover:bg-white/90 font-bold text-lg px-6 py-2 rounded-full shadow-[0_8px_16px_rgba(0,0,0,0.15)] hover:shadow-[0_12px_24px_rgba(0,0,0,0.2)] transition-all duration-200 flex-shrink-0",style:{color:w}},"Done?"))}})()),ee&&!L&&React.createElement("div",{className:"absolute -bottom-2 left-0 right-0 transform translate-y-full pt-2 z-10 flex justify-center bg-transparent"},React.createElement("div",{className:"p-0 bg-transparent"},React.createElement(K.default,null)))))}})();


  // Renderizar el componente usando createRoot
  const root = createRoot(container);
  root.render(React.createElement(WebLNBoostButton, config));
};